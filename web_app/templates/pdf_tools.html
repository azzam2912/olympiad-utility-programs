{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <h2 class="text-2xl font-bold mb-4">PDF Tools</h2>
        <p class="text-gray-700 mb-4">
            Select a tool below to process your PDF files. Each tool performs a specific function on your uploaded PDF.
        </p>
    </div>

    <!-- Tool Selection Tabs -->
    <div class="mb-6">
        <div class="border-b border-gray-200">
            <nav class="flex -mb-px justify-between">
                <button class="tab-button active-tab flex-1 text-center" data-target="extract-images">
                    Extract Images
                </button>
                <button class="tab-button flex-1 text-center" data-target="extract-images-cv">
                    Extract Images (CV)
                </button>
                <button class="tab-button flex-1 text-center" data-target="extract-questions">
                    Extract Questions
                </button>
                <button class="tab-button flex-1 text-center" data-target="split-pdf">
                    Split PDF
                </button>
                <button class="tab-button flex-1 text-center" data-target="remove-hf">
                    Remove Headers/Footers
                </button>
            </nav>
        </div>
    </div>

    <!-- Tool Content -->
    <div class="bg-white rounded-lg shadow-lg flex flex-col gap-10 p-6">
        <!-- Extract Images -->
        <div id="extract-images" class="tool-content">
            <h3 class="text-xl font-bold mb-4">Extract Images from PDF</h3>
            <p class="text-gray-600 mb-4">
                This tool extracts all images from a PDF file and saves them as separate image files.
            </p>
            
            <form hx-post="/pdf-extract-images" 
                  hx-encoding="multipart/form-data"
                  hx-target="#result"
                  hx-indicator="#loading-indicator"
                  class="space-y-4">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    <input type="file" 
                           name="file" 
                           accept=".pdf"
                           class="hidden" 
                           id="file-input-extract"
                           required>
                    <label for="file-input-extract" 
                           class="cursor-pointer block">
                        <div class="text-gray-600">
                            <svg class="mx-auto h-12 w-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <p class="text-lg">Drop your PDF here or click to upload</p>
                        </div>
                    </label>
                </div>

                <div class="mt-4">
                    <label for="prefix" class="block text-sm font-medium text-gray-700">Image Prefix (Optional)</label>
                    <input type="text" 
                           name="prefix" 
                           id="prefix"
                           placeholder="e.g., image_"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <div class="flex space-x-4">
                    <button type="submit" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Extract Images
                    </button>
                </div>
            </form>
        </div>

        <!-- Extract Images CV -->
        <div id="extract-images-cv" class="tool-content hidden">
            <h3 class="text-xl font-bold mb-4">Extract Images using OpenCV</h3>
            <p class="text-gray-600 mb-4">
                This tool uses OpenCV to extract images from a PDF file, which can detect images that the standard extractor might miss.
            </p>
            
            <form hx-post="/pdf-extract-images-cv" 
                  hx-encoding="multipart/form-data"
                  hx-target="#result"
                  hx-indicator="#loading-indicator"
                  class="space-y-4">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    <input type="file" 
                           name="file" 
                           accept=".pdf"
                           class="hidden" 
                           id="file-input-extract-cv"
                           required>
                    <label for="file-input-extract-cv" 
                           class="cursor-pointer block">
                        <div class="text-gray-600">
                            <svg class="mx-auto h-12 w-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <p class="text-lg">Drop your PDF here or click to upload</p>
                        </div>
                    </label>
                </div>

                <div class="flex space-x-4">
                    <button type="submit" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Extract Images (CV)
                    </button>
                </div>
            </form>
        </div>

        <!-- Extract Questions -->
        <div id="extract-questions" class="tool-content hidden">
            <h3 class="text-xl font-bold mb-4">Extract Questions from PDF</h3>
            <p class="text-gray-600 mb-4">
                This tool extracts questions from a PDF file, useful for creating question banks or study materials.
            </p>
            
            <form hx-post="/pdf-extract-questions" 
                  hx-encoding="multipart/form-data"
                  hx-target="#result"
                  hx-indicator="#loading-indicator"
                  class="space-y-4">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    <input type="file" 
                           name="file" 
                           accept=".pdf"
                           class="hidden" 
                           id="file-input-questions"
                           required>
                    <label for="file-input-questions" 
                           class="cursor-pointer block">
                        <div class="text-gray-600">
                            <svg class="mx-auto h-12 w-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <p class="text-lg">Drop your PDF here or click to upload</p>
                        </div>
                    </label>
                </div>

                <div class="flex space-x-4">
                    <button type="submit" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Extract Questions
                    </button>
                </div>
            </form>
        </div>

        <!-- Split PDF -->
        <div id="split-pdf" class="tool-content hidden">
            <h3 class="text-xl font-bold mb-4">Split PDF</h3>
            <p class="text-gray-600 mb-4">
                This tool splits a PDF file at specified page numbers, creating multiple PDF files.
            </p>
            
            <form hx-post="/pdf-split" 
                  hx-encoding="multipart/form-data"
                  hx-target="#result"
                  hx-indicator="#loading-indicator"
                  class="space-y-4">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    <input type="file" 
                           name="file" 
                           accept=".pdf"
                           class="hidden" 
                           id="file-input-split"
                           required>
                    <label for="file-input-split" 
                           class="cursor-pointer block">
                        <div class="text-gray-600">
                            <svg class="mx-auto h-12 w-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <p class="text-lg">Drop your PDF here or click to upload</p>
                        </div>
                    </label>
                </div>

                <div class="mt-4">
                    <label for="split_pages" class="block text-sm font-medium text-gray-700">Split Pages</label>
                    <input type="text" 
                           name="split_pages" 
                           id="split_pages"
                           placeholder="e.g., 5,10,15"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                           required>
                    <p class="mt-1 text-sm text-gray-500">Enter page numbers separated by commas</p>
                </div>

                <div class="flex space-x-4">
                    <button type="submit" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Split PDF
                    </button>
                </div>
            </form>
        </div>

        <!-- Remove Headers/Footers -->
        <div id="remove-hf" class="tool-content hidden">
            <h3 class="text-xl font-bold mb-4">Remove Headers and Footers</h3>
            <p class="text-gray-600 mb-4">
                This tool removes headers and footers from a PDF file, useful for cleaning up documents.
            </p>
            
            <form hx-post="/pdf-remove-hf" 
                  hx-encoding="multipart/form-data"
                  hx-target="#result"
                  hx-indicator="#loading-indicator"
                  class="space-y-4">
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    <input type="file" 
                           name="file" 
                           accept=".pdf"
                           class="hidden" 
                           id="file-input-hf"
                           required>
                    <label for="file-input-hf" 
                           class="cursor-pointer block">
                        <div class="text-gray-600">
                            <svg class="mx-auto h-12 w-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <p class="text-lg">Drop your PDF here or click to upload</p>
                        </div>
                    </label>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <label for="header_height" class="block text-sm font-medium text-gray-700">Header Height</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" 
                                   name="header_height" 
                                   id="header_height"
                                   min="0.01" 
                                   max="0.5" 
                                   step="0.01"
                                   value="0.1"
                                   class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500">
                                of page
                            </span>
                        </div>
                        <p class="mt-1 text-sm text-gray-500">Proportion of page height (0.1 = 10%)</p>
                    </div>
                    
                    <div>
                        <label for="footer_height" class="block text-sm font-medium text-gray-700">Footer Height</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" 
                                   name="footer_height" 
                                   id="footer_height"
                                   min="0.01" 
                                   max="0.5" 
                                   step="0.01"
                                   value="0.1"
                                   class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500">
                                of page
                            </span>
                        </div>
                        <p class="mt-1 text-sm text-gray-500">Proportion of page height (0.1 = 10%)</p>
                    </div>
                </div>

                <div class="flex space-x-4">
                    <button type="submit" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Remove Headers/Footers
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading-indicator" class="htmx-indicator mt-6 bg-white rounded-lg shadow-lg p-6">
        <div class="flex items-center justify-center">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Processing your PDF... This may take a moment.</span>
        </div>
    </div>

    <!-- Result Area -->
    <div id="result" class="mt-6 bg-white rounded-lg shadow-lg p-6 hidden">
        <!-- HTMX will update this area -->
    </div>
</div>

<script>
    // Tab switching functionality
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const toolContents = document.querySelectorAll('.tool-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                tabButtons.forEach(btn => btn.classList.remove('active-tab'));
                
                // Add active class to clicked button
                this.classList.add('active-tab');
                
                // Hide all tool contents
                toolContents.forEach(content => content.classList.add('hidden'));
                
                // Show the selected tool content
                const targetId = this.getAttribute('data-target');
                document.getElementById(targetId).classList.remove('hidden');
                
                // Hide the result area when switching tabs
                document.getElementById('result').classList.add('hidden');
            });
        });
        
        // Add drag and drop highlighting
        const dropAreas = document.querySelectorAll('.border-2.border-dashed');
        
        dropAreas.forEach(area => {
            ['dragenter', 'dragover'].forEach(eventName => {
                area.addEventListener(eventName, function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.classList.remove('border-gray-300');
                    this.classList.add('border-blue-500', 'bg-blue-50');
                }, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                area.addEventListener(eventName, function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.classList.remove('border-blue-500', 'bg-blue-50');
                    this.classList.add('border-gray-300');
                }, false);
            });
            
            // Handle actual file drop
            area.addEventListener('drop', function(e) {
                const fileInput = this.querySelector('input[type="file"]');
                if (fileInput && e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    
                    // Trigger change event to update the label
                    const event = new Event('change', { bubbles: true });
                    fileInput.dispatchEvent(event);
                }
            }, false);
        });
    });

    // Show result area when a form is submitted
    document.addEventListener('htmx:afterRequest', function(event) {
        if (event.detail.successful) {
            document.getElementById('result').classList.remove('hidden');
            
            // Format the response as a nice result
            const resultDiv = document.getElementById('result');
            const response = event.detail.xhr.response;
            
            try {
                const data = JSON.parse(response);
                let resultHTML = `
                    <div class="border-l-4 ${data.status === 'success' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'} p-4 mb-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 ${data.status === 'success' ? 'text-green-500' : 'text-red-500'}" viewBox="0 0 20 20" fill="currentColor">
                                    ${data.status === 'success' 
                                        ? '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />'
                                        : '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />'}
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm ${data.status === 'success' ? 'text-green-700' : 'text-red-700'}">
                                    ${data.message}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add file list if available
                if (data.files && data.files.length > 0) {
                    resultHTML += `
                        <div class="mt-4">
                            <h4 class="text-lg font-semibold mb-2">Files:</h4>
                            <ul class="list-disc pl-5 space-y-1">
                    `;
                    
                    data.files.forEach(file => {
                        resultHTML += `<li class="text-gray-700">${file}</li>`;
                    });
                    
                    if (data.total_files > data.files.length) {
                        resultHTML += `<li class="text-gray-500">... and ${data.total_files - data.files.length} more files</li>`;
                    }
                    
                    resultHTML += `
                            </ul>
                        </div>
                    `;
                }
                
                // Add output folder/file info if available
                if (data.output_folder || data.output_file || data.output_dir) {
                    const outputPath = data.output_folder || data.output_file || data.output_dir;
                    resultHTML += `
                        <div class="mt-4 p-3 bg-gray-100 rounded">
                            <p class="text-sm text-gray-700">
                                <span class="font-semibold">Output location:</span> ${outputPath}
                            </p>
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = resultHTML;
            } catch (e) {
                resultDiv.innerHTML = `<div class="text-gray-700">${response}</div>`;
            }
        }
    });

    // File input display filename
    document.addEventListener('DOMContentLoaded', function() {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        
        fileInputs.forEach(input => {
            input.addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'No file selected';
                const label = this.nextElementSibling.querySelector('p.text-lg');
                label.textContent = fileName;
            });
        });
    });
</script>

<style>
    .tab-button {
        @apply px-4 py-2 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:border-gray-300 transition-colors;
    }
    
    .active-tab {
        @apply text-blue-600 border-blue-600;
    }
    
    /* Add responsive adjustments for smaller screens */
    @media (max-width: 768px) {
        nav.flex.justify-between {
            @apply flex-wrap;
        }
        
        .tab-button {
            @apply text-xs py-3;
        }
    }
</style>
{% endblock %} 